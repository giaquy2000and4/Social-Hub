<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Social-Hub Downloader</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container py-5">
        <h1 class="text-center mb-4">üéß Social-Hub Downloader</h1>
        <p class="text-center text-muted mb-4">T·∫£i Audio v√† Video t·ª´ YouTube, TikTok, SoundCloud</p>

        <!-- Form nh·∫≠p URL -->
        <form method="POST" class="card shadow p-4 mb-5">
            <div class="mb-3">
                <label for="url" class="form-label">D√°n li√™n k·∫øt t·ª´ n·ªÅn t·∫£ng b·∫°n mu·ªën t·∫£i:</label>
                <input type="url" class="form-control" name="url" id="url" placeholder="https://..." required>
            </div>

            <div class="mb-3">
                <label class="form-label">Ch·ªçn n·ªÅn t·∫£ng:</label>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="platform" value="youtube" id="youtube" checked>
                    <label class="form-check-label" for="youtube">YouTube</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="platform" value="tiktok" id="tiktok">
                    <label class="form-check-label" for="tiktok">TikTok</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="platform" value="soundcloud" id="soundcloud">
                    <label class="form-check-label" for="soundcloud">SoundCloud</label>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">ƒê·ªãnh d·∫°ng t·∫£i xu·ªëng:</label>
                <select class="form-select" name="format" required>
                    <option value="audio">Audio</option>
                    <option value="video">Video</option>
                </select>
            </div>

            <div class="d-grid">
                <button type="submit" class="btn btn-primary">Ph√¢n t√≠ch & Hi·ªÉn th·ªã t√πy ch·ªçn</button>
            </div>
        </form>

        {% if media_info %}
        <div class="card shadow">
            <div class="row g-0">
                {% if media_info.thumbnail %}
                <div class="col-md-4">
                    <img src="{{ media_info.thumbnail }}" class="img-fluid rounded-start" alt="Thumbnail">
                </div>
                {% endif %}
                <div class="col-md-8">
                    <div class="card-body">
                        <h5 class="card-title">{{ media_info.title }}</h5>
                        <p class="card-text"><strong>Ngu·ªìn:</strong> {{ media_info.platform|capitalize }}</p>
                        <p class="card-text"><strong>Ng∆∞·ªùi ƒëƒÉng:</strong> {{ media_info.uploader }}</p>
                        <p class="card-text"><strong>Th·ªùi l∆∞·ª£ng:</strong>
                            {% if media_info.duration %}
                                {% set minutes = (media_info.duration // 60) %}
                                {% set seconds = (media_info.duration % 60) %}
                                {{ minutes }}:{{ "%02d"|format(seconds) }}
                            {% else %}
                                N/A
                            {% endif %}
                        </p>

                        {% if media_info.platform == 'youtube' %}
                        <!-- Form t·∫£i v·ªÅ v·ªõi t√πy ch·ªçn ch·∫•t l∆∞·ª£ng cho YouTube -->
                        <form method="POST" action="/download" class="mt-3">
                            <input type="hidden" name="url" value="{{ media_info.url }}">
                            <input type="hidden" name="platform" value="{{ media_info.platform }}">
                            <input type="hidden" name="format" value="{{ media_info.format }}">

                            <!-- Hi·ªÉn th·ªã t√πy ch·ªçn ch·∫•t l∆∞·ª£ng -->
                            <div class="mb-3">
                                <label class="form-label">
                                    <strong>Ch·ªçn ch·∫•t l∆∞·ª£ng {{ '√¢m thanh' if media_info.format == 'audio' else 'video' }}:</strong>
                                </label>
                                <select class="form-select" name="format_id" required>
                                    {% if media_info.format == 'audio' %}
                                        {% for fmt in media_info.audio_formats %}
                                        <option value="{{ fmt.format_id }}">
                                            {{ fmt.quality }} - {{ fmt.ext|upper }}
                                            ({{ fmt.filesize }}) - {{ fmt.acodec|upper }}
                                        </option>
                                        {% endfor %}
                                        {% if not media_info.audio_formats %}
                                        <option value="bestaudio">√Çm thanh ch·∫•t l∆∞·ª£ng t·ªët nh·∫•t</option>
                                        {% endif %}
                                    {% else %}
                                        {% for fmt in media_info.video_formats %}
                                        <option value="{{ fmt.format_id }}">
                                            {{ fmt.quality }}{% if fmt.fps %} - {{ fmt.fps }}fps{% endif %} - {{ fmt.ext|upper }}
                                            ({{ fmt.filesize }}) - {{ fmt.vcodec|upper }}
                                            {% if fmt.acodec != 'none' %}+ {{ fmt.acodec|upper }}{% endif %}
                                        </option>
                                        {% endfor %}
                                        {% if not media_info.video_formats %}
                                        <option value="best">Video ch·∫•t l∆∞·ª£ng t·ªët nh·∫•t</option>
                                        {% endif %}
                                    {% endif %}
                                </select>
                                <div class="form-text">
                                    Ch·ªçn ch·∫•t l∆∞·ª£ng ph√π h·ª£p v·ªõi nhu c·∫ßu c·ªßa b·∫°n. Ch·∫•t l∆∞·ª£ng cao h∆°n s·∫Ω c√≥ dung l∆∞·ª£ng l·ªõn h∆°n.
                                </div>
                            </div>

                            <div class="d-grid">
                                <button type="submit" class="btn btn-success btn-lg">
                                    <i class="bi bi-download"></i>
                                    Download {{ 'Audio' if media_info.format == 'audio' else 'Video' }}
                                </button>
                            </div>
                        </form>
                        {% else %}
                        <!-- Form t·∫£i v·ªÅ ƒë∆°n gi·∫£n cho c√°c n·ªÅn t·∫£ng kh√°c -->
                        <form method="POST" action="/download" class="d-inline">
                            <input type="hidden" name="url" value="{{ media_info.url }}">
                            <input type="hidden" name="platform" value="{{ media_info.platform }}">
                            <input type="hidden" name="format" value="{{ media_info.format }}">
                            <button type="submit" class="btn btn-success">
                                T·∫£i v·ªÅ {{ 'MP3' if media_info.format == 'audio' else 'MP4' }}
                            </button>
                        </form>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        {% if media_info.platform == 'youtube' and (media_info.video_formats or media_info.audio_formats) %}
        <!-- B·∫£ng th√¥ng tin chi ti·∫øt c√°c ƒë·ªãnh d·∫°ng c√≥ s·∫µn -->
        <div class="card shadow mt-4">
            <div class="card-header">
                <h6 class="mb-0">üìä Th√¥ng tin chi ti·∫øt c√°c ƒë·ªãnh d·∫°ng c√≥ s·∫µn</h6>
            </div>
            <div class="card-body">
                {% if media_info.format == 'video' and media_info.video_formats %}
                <h6 class="text-primary">ƒê·ªãnh d·∫°ng Video:</h6>
                <div class="table-responsive mb-3">
                    <table class="table table-sm table-striped">
                        <thead>
                            <tr>
                                <th>Ch·∫•t l∆∞·ª£ng</th>
                                <th>ƒê·ªãnh d·∫°ng</th>
                                <th>FPS</th>
                                <th>Dung l∆∞·ª£ng</th>
                                <th>Video Codec</th>
                                <th>Audio Codec</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for fmt in media_info.video_formats[:10] %}
                            <tr>
                                <td><span class="badge bg-primary">{{ fmt.quality }}</span></td>
                                <td>{{ fmt.ext|upper }}</td>
                                <td>{{ fmt.fps or 'N/A' }}</td>
                                <td>{{ fmt.filesize }}</td>
                                <td><code>{{ fmt.vcodec }}</code></td>
                                <td><code>{{ fmt.acodec if fmt.acodec != 'none' else 'Kh√¥ng c√≥' }}</code></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}

                {% if media_info.format == 'audio' and media_info.audio_formats %}
                <h6 class="text-success">ƒê·ªãnh d·∫°ng Audio:</h6>
                <div class="table-responsive">
                    <table class="table table-sm table-striped">
                        <thead>
                            <tr>
                                <th>Ch·∫•t l∆∞·ª£ng</th>
                                <th>ƒê·ªãnh d·∫°ng</th>
                                <th>Dung l∆∞·ª£ng</th>
                                <th>Audio Codec</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for fmt in media_info.audio_formats[:10] %}
                            <tr>
                                <td><span class="badge bg-success">{{ fmt.quality }}</span></td>
                                <td>{{ fmt.ext|upper }}</td>
                                <td>{{ fmt.filesize }}</td>
                                <td><code>{{ fmt.acodec }}</code></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}
        {% endif %}
    </div>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>