<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Social-Hub Downloader</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container py-5">
        <h1 class="text-center mb-4">üéß Social-Hub Downloader</h1>
        <p class="text-center text-muted mb-4">T·∫£i nh·∫°c v√† video t·ª´ YouTube, TikTok, SoundCloud</p>

        <!-- Form nh·∫≠p URL -->
        <form method="POST" class="card shadow p-4 mb-5">
            <div class="mb-3">
                <label for="url" class="form-label">D√°n li√™n k·∫øt t·ª´ n·ªÅn t·∫£ng b·∫°n mu·ªën t·∫£i:</label>
                <input type="url" class="form-control" name="url" id="url" placeholder="https://..." required>
            </div>

            <div class="mb-3">
                <label class="form-label">Ch·ªçn n·ªÅn t·∫£ng:</label>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="platform" value="youtube" id="youtube" checked>
                    <label class="form-check-label" for="youtube">YouTube</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="platform" value="tiktok" id="tiktok">
                    <label class="form-check-label" for="tiktok">TikTok</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="platform" value="soundcloud" id="soundcloud">
                    <label class="form-check-label" for="soundcloud">SoundCloud</label>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label">ƒê·ªãnh d·∫°ng t·∫£i xu·ªëng:</label>
                <select class="form-select" name="format" required>
                    <option value="audio">√Çm thanh (MP3)</option>
                    <option value="video">Video (MP4)</option>
                </select>
            </div>

            <div class="d-grid">
                <button type="submit" class="btn btn-primary">Ph√¢n t√≠ch & T·∫£i xu·ªëng</button>
            </div>
        </form>

        <!-- N·∫øu c√≥ th√¥ng tin media -->
        {% if media_info %}
        <div class="card shadow">
            <div class="row g-0">
                {% if media_info.thumbnail %}
                <div class="col-md-4">
                    <img src="{{ media_info.thumbnail }}" class="img-fluid rounded-start" alt="Thumbnail">
                </div>
                {% endif %}
                <div class="col-md-8">
                    <div class="card-body">
                        <h5 class="card-title">{{ media_info.title }}</h5>
                        <p class="card-text"><strong>Ngu·ªìn:</strong> {{ media_info.platform|capitalize }}</p>
                        <p class="card-text"><strong>Ng∆∞·ªùi ƒëƒÉng:</strong> {{ media_info.uploader }}</p>
                        <p class="card-text"><strong>Th·ªùi l∆∞·ª£ng:</strong> {{ media_info.duration }} gi√¢y</p>
                        <button class="btn btn-success" onclick="download('{{ media_info.url }}', '{{ media_info.platform }}', '{{ media_info.format }}')">
                            T·∫£i v·ªÅ {{ 'MP3' if media_info.format == 'audio' else 'MP4' }}
                        </button>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- JS ƒë·ªÉ g·ª≠i request t·∫£i -->
    <script>
        function download(url, platform, format) {
            fetch('/download', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ url, platform, format })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('T·∫£i th·∫•t b·∫°i.');
                }
                return response.blob();
            })
            .then(blob => {
                const link = document.createElement('a');
                link.href = window.URL.createObjectURL(blob);
                link.download = `media.${format === 'audio' ? 'mp3' : 'mp4'}`;
                link.click();
            })
            .catch(error => {
                alert("C√≥ l·ªói x·∫£y ra: " + error.message);
            });
        }
    </script>
</body>
</html>
